<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Arc Chain Plotter</title>
<style>
    canvas { 
        background: lightgray;  /* Or any contrasting color */
        border: 1px solid black;
    }
    </style>
<script defer="" type="text/javascript">(function(global){ const gopt=getQueryParams();function setupSlider(selector,options){var parent=document.querySelector(selector);if(!parent){return;}if(!options.name){options.name=selector.substring(1);}return createSlider(parent,options);}function createSlider(parent,options){var precision=options.precision||0;var min=options.min||0;var step=options.step||1;var value=options.value||0;var max=options.max||1;var fn=options.slide;var name=gopt["ui-" + options.name]||options.name;var uiPrecision=options.uiPrecision===undefined?precision:options.uiPrecision;var uiMult=options.uiMult||1;min /=step;max /=step;value /=step;parent.innerHTML=`
      <div class="gman-widget-outer">
        <div class="gman-widget-label">${name}</div>
        <div class="gman-widget-value"></div>
        <input class="gman-widget-slider" type="range" min="${min}" max="${max}" value="${value}" />
      </div>
    `;var valueElem=parent.querySelector(".gman-widget-value");var sliderElem=parent.querySelector(".gman-widget-slider");function updateValue(value){valueElem.textContent=(value * step * uiMult).toFixed(uiPrecision);}updateValue(value);function handleChange(event){var value=parseInt(event.target.value);updateValue(value);fn(event,{value:value * step});}sliderElem.addEventListener('input',handleChange);sliderElem.addEventListener('change',handleChange);return{elem:parent,updateValue:(v)=>{v /=step;sliderElem.value=v;updateValue(v);},};}function makeSlider(options){const div=document.createElement("div");return createSlider(div,options);}var widgetId=0;function getWidgetId(){return "__widget_" + widgetId++;}function makeCheckbox(options){const div=document.createElement("div");div.className="gman-widget-outer";const label=document.createElement("label");const id=getWidgetId();label.setAttribute('for',id);label.textContent=gopt["ui-" + options.name]||options.name;label.className="gman-checkbox-label";const input=document.createElement("input");input.type="checkbox";input.checked=options.value;input.id=id;input.className="gman-widget-checkbox";div.appendChild(label);div.appendChild(input);input.addEventListener('change',function(e){options.change(e,{value:e.target.checked,});});return{elem:div,updateValue:function(v){input.checked=!!v;},};}function makeOption(options){const div=document.createElement("div");div.className="gman-widget-outer";const label=document.createElement("label");const id=getWidgetId();label.setAttribute('for',id);label.textContent=gopt["ui-" + options.name]||options.name;label.className="gman-widget-label";const selectElem=document.createElement("select");options.options.forEach((name,ndx)=>{const opt=document.createElement("option");opt.textContent=gopt["ui-" + name]||name;opt.value=ndx;opt.selected=ndx===options.value;selectElem.appendChild(opt);});selectElem.className="gman-widget-select";div.appendChild(label);div.appendChild(selectElem);selectElem.addEventListener('change',function(e){options.change(e,{value:selectElem.selectedIndex,});});return{elem:div,updateValue:function(v){selectElem.selectedIndex=v;},};}function noop(){}function genSlider(object,ui){const changeFn=ui.change||noop;ui.name=ui.name||ui.key;ui.value=object[ui.key];ui.slide=ui.slide||function(event,uiInfo){object[ui.key]=uiInfo.value;changeFn();};return makeSlider(ui);}function genCheckbox(object,ui){const changeFn=ui.change||noop;ui.value=object[ui.key];ui.name=ui.name||ui.key;ui.change=function(event,uiInfo){object[ui.key]=uiInfo.value;changeFn();};return makeCheckbox(ui);}function genOption(object,ui){const changeFn=ui.change||noop;ui.value=object[ui.key];ui.name=ui.name||ui.key;ui.change=function(event,uiInfo){object[ui.key]=uiInfo.value;changeFn();};return makeOption(ui);}const uiFuncs={slider:genSlider,checkbox:genCheckbox,option:genOption,};function setupUI(parent,object,uiInfos){const widgets={};uiInfos.forEach(function(ui){const widget=uiFuncs[ui.type](object,ui);parent.appendChild(widget.elem);widgets[ui.key]=widget;});return widgets;}function updateUI(widgets,data){Object.keys(widgets).forEach(key=>{const widget=widgets[key];widget.updateValue(data[key]);});}function getQueryParams(){var params={};if(window.hackedParams){Object.keys(window.hackedParams).forEach(function(key){params[key]=window.hackedParams[key];});}if(window.location.search){window.location.search.substring(1).split("&").forEach(function(pair){var keyValue=pair.split("=").map(function(kv){return decodeURIComponent(kv);});params[keyValue[0]]=keyValue[1];});}return params;} if(!("modules" in global)){global["modules"]={}}global.modules["webgl_lessons_ui.module.js"]={setupSlider:setupSlider,createSlider:createSlider,makeSlider:makeSlider,makeCheckbox:makeCheckbox,setupUI:setupUI,updateUI:updateUI,};})(window);(function(global){let{setupUI,updateUI,setupSlider,makeSlider,makeCheckbox}=modules["webgl_lessons_ui.module.js"];window.webglLessonsUI={setupUI:setupUI,updateUI:updateUI,setupSlider:setupSlider,makeSlider:makeSlider,makeCheckbox:makeCheckbox,};console.log(Object.keys(webglLessonsUI));})(window);</script>
<script> function debugLog(obj){const logElement=document.getElementById('debugLogText');logElement.innerHTML +=JSON.stringify(obj)+ '<br>';logElement.scrollTop=logElement.scrollHeight;};</script>
</head>
<body>
<div>
<canvas height="500" id="arcCanvas" width="500"></canvas>
<!-- Add this to your HTML body -->
<div id="debugLogText" style="position: absolute; top: 0; right: 0; width: 50%; height: 100%; overflow-y: scroll; background: white; color: black;"></div>
</div>
<input id="file-input" type="file"/>
<select id="outline-selector" name="outline-selector"></select>
<button id="downloadBtn">Download</button>
<h3>Contents of the file:</h3>
<pre id="file-content"></pre>
<script type="text/javascript">(function(global){function TurtlePathLengthArea(TurtlePath){ let totalLength=0;let totalArea=0;let firstMoment=[0,0];let arcStartPoint=[0,0];let arcStartAngle=0;let arcEndAngle=0;for(let[arcLength,arcAngle]of TurtlePath){const halfArcAngle=arcAngle / 2;const chordAngle=arcStartAngle + halfArcAngle;const cosChordAngle=Math.cos(chordAngle);const sinChordAngle=Math.sin(chordAngle);totalLength +=arcLength;let chordLength;if(arcAngle !==0){if(arcLength !==0){const radius=arcLength / arcAngle;const sinHalfArcAngle=Math.sin(halfArcAngle);chordLength=radius * sinHalfArcAngle * 2;const arcSegmentArea=0.5 * radius ** 2 *(arcAngle - Math.sin(arcAngle));const y_a=(2/3)*(radius * sinHalfArcAngle)** 3;totalArea +=arcSegmentArea;firstMoment[0]+=arcSegmentArea *(arcStartPoint[0]- radius * Math.sin(arcStartAngle))+ y_a * sinChordAngle;firstMoment[1]+=arcSegmentArea *(arcStartPoint[1]+ radius * Math.cos(arcStartAngle))- y_a * cosChordAngle;}else{chordLength=0;}}else{chordLength=arcLength;}const arcEndPoint=[arcStartPoint[0]+ chordLength * cosChordAngle,arcStartPoint[1]+ chordLength * sinChordAngle];arcEndAngle=arcStartAngle + arcAngle;const triangleArea=(arcStartPoint[0]* arcEndPoint[1]- arcEndPoint[0]* arcStartPoint[1])/ 2;totalArea +=triangleArea;firstMoment[0]+=triangleArea *(arcStartPoint[0]+ arcEndPoint[0])/ 3;firstMoment[1]+=triangleArea *(arcStartPoint[1]+ arcEndPoint[1])/ 3;arcStartPoint=arcEndPoint;arcStartAngle=arcEndAngle;}const centroid=[firstMoment[0]/ totalArea,firstMoment[1]/ totalArea];return[totalLength,totalArea,arcStartPoint,arcEndAngle,centroid];}function SegmentsLengthArea(Segs){let l=0;let area=0;let prevPoint=[0,0];let prevAngle=0;for(let i=0;i<Segs.length;i++){let[dl,dang]=Segs[i];let dang_2=dang/2;l +=dl;let chordLength;if(dang !==0){let r=dl/dang;chordLength=r*Math.sin(dang_2)*2;let correction=0.5*r*r *(dang - Math.sin(dang));area +=correction;}else{chordLength=dl;}let currentPoint=[prevPoint[0]+ chordLength * Math.cos(prevAngle + dang_2),prevPoint[1]+ chordLength * Math.sin(prevAngle + dang_2)];area +=(prevPoint[0]* currentPoint[1]- currentPoint[0]* prevPoint[1])/ 2;prevPoint=currentPoint;prevAngle +=dang;}return[l,Math.abs(area),prevPoint,prevAngle];}function* Segments2Complex({p0_a0_segs=[[[0,0],[1,0]],[]],scale=1.0,tol=0.05,offs=0,loops=1,return_start=false}){const[p0,a0]=p0_a0_segs[0];const Segs=p0_a0_segs[1];let a=a0.slice();let p=p0.slice();p[0]=p[0]- a[0]* offs;p[1]=p[1]- a[1]* offs;let L=0;if(return_start){yield{point:p,angle:a,length:L,segmentIndex:-1};}let loopcount=0;while(loops===null||loops===Infinity||loopcount<loops){loopcount++;for(let X=0;X<Segs.length;X++){let[l,da,..._]=Segs[X];l *=scale;let n;let v;let dda;if(da !==0){let r=l / da;r +=offs;if(r !==0){l=r * da;let dl=2 * Math.sqrt(2 * Math.abs(r)* tol);n=Math.max(Math.ceil(6 * Math.abs(da /(2 * Math.PI))),Math.floor(l / dl)+ 1);let dda2=[Math.cos(0.5*da / n),Math.sin(0.5*da / n)];v=[2 * r* dda2[1]* dda2[0],2 * r* dda2[1]* dda2[1]];v=[v[0]* a[0]- v[1]* a[1],v[0]* a[1]+ v[1]* a[0]];}else{n=1;v=[0,0];}dda=[Math.cos(da / n),Math.sin(da / n)];for(let i=0;i<n;i++){L +=l / n;p[0]+=v[0];p[1]+=v[1];a=[a[0]* dda[0]- a[1]* dda[1],a[0]* dda[1]+ a[1]* dda[0]];yield{point:p.slice(),angle:a,length:L,segmentIndex:X};v=[v[0]* dda[0]- v[1]* dda[1],v[0]* dda[1]+ v[1]* dda[0]];}}else{n=1;L +=l;p[0]+=l * a[0];p[1]+=l * a[1];yield{point:p.slice(),angle:a,length:L,segmentIndex:X};}}}}function plot_segments(ctx,{p0=[0,0],a0=[1,0],segs=[],scale=1.0,tol=0.05,offs=0,loops=1,return_start=true}={}){let gen=Segments2Complex({p0_a0_segs:[[p0,a0],segs],scale:scale,tol:tol,offs:0,loops:loops,return_start:return_start});ctx.beginPath();let{value:{point,angle:[cos_ang,sin_ang]}}=gen.next();ctx.moveTo(point[0]-offs*sin_ang,point[1]+offs*cos_ang);for(let{point,angle:[cos_ang,sin_ang]}of gen){ctx.lineTo(point[0]-offs*sin_ang,point[1]+offs*cos_ang);}ctx.stroke()}if(!("modules" in global)){global["modules"]={}}global.modules["turtle.js"]={TurtlePathLengthArea:TurtlePathLengthArea,SegmentsLengthArea:SegmentsLengthArea,plot_segments:plot_segments,};})(window);(function(global){ function stringifyFormatted(data,initialIndent=2,maxIndentLevel=2){const maxIndent=initialIndent * maxIndentLevel;let jsonString=JSON.stringify(data,null,initialIndent);let result='';let lines=jsonString.split('\n');let previousLine='';for(let i=0;i<lines.length;i++){let line=lines[i];let trimmedLine=line.trim();let indent=line.match(/^\s*/)[0].length;if(indent<maxIndent||(indent===maxIndent&&(trimmedLine.startsWith('[')||trimmedLine.startsWith('{')))){if(previousLine !==''){result +=previousLine + '\n';}previousLine=line;}else{if(previousLine !==''){result +=previousLine + ' ';}previousLine=trimmedLine;}if(i===lines.length - 1&&previousLine !==''){result +=previousLine;}}return result;}if(!("modules" in global)){global["modules"]={}}global.modules["json_utils.js"]={stringifyFormatted:stringifyFormatted,};})(window);(function(global){let{plot_segments,SegmentsLengthArea,TurtlePathLengthArea}=modules["turtle.js"];let{stringifyFormatted}=modules["json_utils.js"];window.plot_segments=plot_segments;window.SegmentsLengthArea=SegmentsLengthArea;window.TurtlePathLengthArea=TurtlePathLengthArea;window.stringifyFormatted=stringifyFormatted;console.log("in Module1");})(window);</script>
<script> "use strict";const deg=Math.PI/180;const rad2deg=1/deg;let targetAngleRadians;let targetRadius=10;const target=[null,null,null];function updateTargetAngle(event,ui){targetAngleRadians=ui.value*deg;target[0]=Math.sin(targetAngleRadians)* targetRadius;target[2]=Math.cos(targetAngleRadians)* targetRadius;}</script>
<script type="text/javascript">(function(global){webglLessonsUI.setupSlider("#targetAngle",{value:targetAngleRadians*rad2deg,slide:updateTargetAngle,min:-360,max:360});})(window);</script>
<script> function formatFloat(num,decimalPlaces){return num.toFixed(decimalPlaces);}function deepCopyArray(arr){return arr.map(item=>Array.isArray(item)?deepCopyArray(item):item);}var filename="readme.txt";var text="Text of the file goes here.";var blob=new Blob([text],{type:'text/gcode'});var link=document.createElement("a");link.download=filename;link.innerHTML="Download File";link.href=window.URL.createObjectURL(blob);document.body.appendChild(link)</script>
<script id="main" type="text/javascript"> "use strict";let cookieCutterArea=2000;let outlines={"Duck":[[0.4,-10.0],[13.297,25.0],[3,-80.0],[4,160.0],[22.913,90.0],[15,90.0],[5,-90.0],[5,20.0],[3,170.0],[2,-20.0],[3,-90.0],[15,220.0],[5,-125.0]]};let brickworks={"centered":[[[-0.45,0.9],[-1.35,0.9],[0.45,0.9],[1.35,0.9]],[[-0.8,0.8],[-1.6,0.8],[0.8,0.8],[1.6,0.8],[0.0,0.8]],[[-1.1,0.733],[-1.833,0.733],[1.1,0.733],[1.833,0.733],[-0.367,0.733],[0.367,0.733]],[[-0.92,0.92],[-1.84,0.92],[0.92,0.92],[1.84,0.92],[0.0,0.92]],[[0.0,1.0],[-1.9,1.0],[1.9,1.0]],[[0.0,0.8],[-2.0,1.0],[2.0,1.0]],[[0.0,0.6],[-2.05,0.9],[2.05,0.9]],[[0.0,0.5],[-2.05,0.9],[2.05,0.9]],[[0.0,0.5],[-2.05,0.9],[2.05,0.9]],[[0.0,0.5],[-1.95,0.9],[1.95,0.9]],[[0.0,0.5],[-1.85,0.9],[1.85,0.9]],[[0.0,0.5],[-1.7,1.0],[1.7,1.0]],[[0.0,0.5],[-1.5,1.0],[1.5,1.0]],[[0.0,0.5],[-1.3,1.0],[1.3,1.0]],[[0.0,0.5],[-1.1,1.0],[1.1,1.0]],[[0.0,0.5],[-0.9,1.0],[0.9,1.0]],[[0.0,0.6],[-0.75,0.9],[0.75,0.9]],[[-0.5,1.0],[0.5,1.0]],[[-0.533,0.533],[-0.0,0.533],[0.533,0.533]],[[-0.3,0.6],[0.3,0.6]]]};function updateOutlineSelector(){while(outlineSelector.options.length)outlineSelector.options.remove(0);Object.entries(outlines).forEach(([k2,v2])=>{v2.forEach((x)=>{x[1]*=deg;});var el=document.createElement("option");el.textContent=k2;el.value=k2;outlineSelector.appendChild(el);});const event=new Event('change',{bubbles:true});outlineSelector.dispatchEvent(event);};function readSingleFile(e){var file=e.target.files[0];if(!file){return;}var reader=new FileReader();reader.onload=function(e){var contents=e.target.result;let decodedContents=JSON.parse(contents);outlines=decodedContents["outlines"];updateOutlineSelector();brickworks=decodedContents["brickworks"];document.getElementById('downloadBtn').disabled=false;};reader.readAsText(file);}function displayContents(contents){var element=document.getElementById('file-content');element.textContent=contents;}function drawSelectedOutline(e){const canvas=document.getElementById('arcCanvas');const ctx=canvas.getContext('2d');ctx.reset();ctx.clearRect(0,0,canvas.width,canvas.height);ctx.translate(canvas.width/2,canvas.height/2);ctx.scale(1,1);let key;try{key=e.target.value;}catch(e){}if(key===undefined)key="Duck";let[l,a,,,centroid]=TurtlePathLengthArea(outlines[key]);let scale=Math.sqrt(cookieCutterArea/a);debugLog("key= "+key+", l= "+l+", a= "+a+", scale= "+scale);let a0=[1,0];let p0=[-centroid[0]*scale*5,-centroid[1]*scale*5];plot_segments(ctx,{segs:outlines[key],p0:p0,a0:a0,scale:scale*5});plot_segments(ctx,{segs:outlines[key],p0:p0,a0:a0,offs:3,scale:scale*5});}document.getElementById('file-input').addEventListener('change',readSingleFile,false);var outlineSelector;function initDocument(){outlineSelector=document.getElementById('outline-selector');outlineSelector.addEventListener('change',drawSelectedOutline,false);updateOutlineSelector();drawSelectedOutline();}document.getElementById('downloadBtn').addEventListener('click',function(){if(outlines&&brickworks){const outlinesCopy={};for(let key in outlines){let valueArrayCopy=[... outlines[key]];outlinesCopy[key]=valueArrayCopy;valueArrayCopy.forEach(([l,angRad],i,arr)=>{arr[i]=[l,Math.round(angRad*rad2deg*1000)/1000];});};const content=stringifyFormatted({outlines:outlinesCopy,brickworks:brickworks},2,3);const blob=new Blob([content],{type:'application/octet-stream'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.click();URL.revokeObjectURL(link.href);this.disabled=true;}});document.addEventListener("DOMContentLoaded",initDocument);</script>
<div class="slider" id="targetAngle"></div>
</body>
</html>