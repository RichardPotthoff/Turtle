<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Arc Chain Plotter</title>
<style>
    canvas { 
        background: lightgray;  /* Or any contrasting color */
        border: 1px solid black;
    }
    </style>
<script> function debugLog(obj){const logElement=document.getElementById('debugLogText');logElement.innerHTML +=JSON.stringify(obj)+ '<br>';logElement.scrollTop=logElement.scrollHeight;};</script>
</head>
<body>
<div>
<canvas height="500" id="arcCanvas" width="500"></canvas>
<!-- Add this to your HTML body -->
<div id="debugLogText" style="position: absolute; top: 0; right: 0; width: 50%; height: 100%; overflow-y: scroll; background: white; color: black;"></div>
</div>
<input id="file-input" type="file"/>
<select id="outline-selector" name="outline-selector"></select>
<button id="downloadBtn">Download Outlines</button>
<button id="downloadAppBtn">Download App</button>
<script type="text/javascript">(function(global){function TurtlePathLengthArea(TurtlePath){ let totalLength=0;let totalArea=0;let firstMoment=[0,0];let arcStartPoint=[0,0];let arcStartAngle=0;let arcEndAngle=0;for(let[arcLength,arcAngle]of TurtlePath){const halfArcAngle=arcAngle / 2;const chordAngle=arcStartAngle + halfArcAngle;const cosChordAngle=Math.cos(chordAngle);const sinChordAngle=Math.sin(chordAngle);totalLength +=arcLength;let chordLength;if(arcAngle !==0){if(arcLength !==0){const radius=arcLength / arcAngle;const sinHalfArcAngle=Math.sin(halfArcAngle);chordLength=radius * sinHalfArcAngle * 2;const arcSegmentArea=0.5 * radius ** 2 *(arcAngle - Math.sin(arcAngle));const y_a=(2/3)*(radius * sinHalfArcAngle)** 3;totalArea +=arcSegmentArea;firstMoment[0]+=arcSegmentArea *(arcStartPoint[0]- radius * Math.sin(arcStartAngle))+ y_a * sinChordAngle;firstMoment[1]+=arcSegmentArea *(arcStartPoint[1]+ radius * Math.cos(arcStartAngle))- y_a * cosChordAngle;}else{chordLength=0;}}else{chordLength=arcLength;}const arcEndPoint=[arcStartPoint[0]+ chordLength * cosChordAngle,arcStartPoint[1]+ chordLength * sinChordAngle];arcEndAngle=arcStartAngle + arcAngle;const triangleArea=(arcStartPoint[0]* arcEndPoint[1]- arcEndPoint[0]* arcStartPoint[1])/ 2;totalArea +=triangleArea;firstMoment[0]+=triangleArea *(arcStartPoint[0]+ arcEndPoint[0])/ 3;firstMoment[1]+=triangleArea *(arcStartPoint[1]+ arcEndPoint[1])/ 3;arcStartPoint=arcEndPoint;arcStartAngle=arcEndAngle;}const centroid=[firstMoment[0]/ totalArea,firstMoment[1]/ totalArea];return[totalLength,totalArea,arcStartPoint,arcEndAngle,centroid];}function SegmentsLengthArea(Segs){let l=0;let area=0;let prevPoint=[0,0];let prevAngle=0;for(let i=0;i<Segs.length;i++){let[dl,dang]=Segs[i];let dang_2=dang/2;l +=dl;let chordLength;if(dang !==0){let r=dl/dang;chordLength=r*Math.sin(dang_2)*2;let correction=0.5*r*r *(dang - Math.sin(dang));area +=correction;}else{chordLength=dl;}let currentPoint=[prevPoint[0]+ chordLength * Math.cos(prevAngle + dang_2),prevPoint[1]+ chordLength * Math.sin(prevAngle + dang_2)];area +=(prevPoint[0]* currentPoint[1]- currentPoint[0]* prevPoint[1])/ 2;prevPoint=currentPoint;prevAngle +=dang;}return[l,Math.abs(area),prevPoint,prevAngle];}function* Segments2Complex({p0_a0_segs=[[[0,0],[1,0]],[]],scale=1.0,tol=0.05,offs=0,loops=1,return_start=false}){const[p0,a0]=p0_a0_segs[0];const Segs=p0_a0_segs[1];let a=a0.slice();let p=p0.slice();p[0]=p[0]- a[0]* offs;p[1]=p[1]- a[1]* offs;let L=0;if(return_start){yield{point:p,angle:a,length:L,segmentIndex:-1};}let loopcount=0;while(loops===null||loops===Infinity||loopcount<loops){loopcount++;for(let X=0;X<Segs.length;X++){let[l,da,..._]=Segs[X];l *=scale;let n;let v;let dda;if(da !==0){let r=l / da;r +=offs;if(r !==0){l=r * da;let dl=2 * Math.sqrt(2 * Math.abs(r)* tol);n=Math.max(Math.ceil(6 * Math.abs(da /(2 * Math.PI))),Math.floor(l / dl)+ 1);let dda2=[Math.cos(0.5*da / n),Math.sin(0.5*da / n)];v=[2 * r* dda2[1]* dda2[0],2 * r* dda2[1]* dda2[1]];v=[v[0]* a[0]- v[1]* a[1],v[0]* a[1]+ v[1]* a[0]];}else{n=1;v=[0,0];}dda=[Math.cos(da / n),Math.sin(da / n)];for(let i=0;i<n;i++){L +=l / n;p[0]+=v[0];p[1]+=v[1];a=[a[0]* dda[0]- a[1]* dda[1],a[0]* dda[1]+ a[1]* dda[0]];yield{point:p.slice(),angle:a,length:L,segmentIndex:X};v=[v[0]* dda[0]- v[1]* dda[1],v[0]* dda[1]+ v[1]* dda[0]];}}else{n=1;L +=l;p[0]+=l * a[0];p[1]+=l * a[1];yield{point:p.slice(),angle:a,length:L,segmentIndex:X};}}}}function plot_segments(ctx,{p0=[0,0],a0=[1,0],segs=[],scale=1.0,tol=0.05,offs=0,loops=1,return_start=true}={}){let gen=Segments2Complex({p0_a0_segs:[[p0,a0],segs],scale:scale,tol:tol,offs:0,loops:loops,return_start:return_start});ctx.beginPath();let{value:{point,angle:[cos_ang,sin_ang]}}=gen.next();ctx.moveTo(point[0]-offs*sin_ang,point[1]+offs*cos_ang);for(let{point,angle:[cos_ang,sin_ang]}of gen){ctx.lineTo(point[0]-offs*sin_ang,point[1]+offs*cos_ang);}ctx.stroke()}if(!("modules" in global)){global["modules"]={}}global.modules["turtle.js"]={TurtlePathLengthArea:TurtlePathLengthArea,SegmentsLengthArea:SegmentsLengthArea,plot_segments:plot_segments,};})(window);(function(global){ function stringifyFormatted(data,initialIndent=2,maxIndentLevel=2){const maxIndent=initialIndent * maxIndentLevel;let jsonString=JSON.stringify(data,null,initialIndent);let result='';let lines=jsonString.split('\n');let previousLine='';for(let i=0;i<lines.length;i++){let line=lines[i];let trimmedLine=line.trim();let indent=line.match(/^\s*/)[0].length;if(indent<maxIndent||(indent===maxIndent&&(trimmedLine.startsWith('[')||trimmedLine.startsWith('{')))){if(previousLine !==''){result +=previousLine + '\n';}previousLine=line;}else{if(previousLine !==''){result +=previousLine + ' ';}previousLine=trimmedLine;}if(i===lines.length - 1&&previousLine !==''){result +=previousLine;}}return result;}if(!("modules" in global)){global["modules"]={}}global.modules["json_utils.js"]={stringifyFormatted:stringifyFormatted,};})(window);(function(global){let{plot_segments,SegmentsLengthArea,TurtlePathLengthArea}=modules["turtle.js"];let{stringifyFormatted}=modules["json_utils.js"];window.plot_segments=plot_segments;window.SegmentsLengthArea=SegmentsLengthArea;window.TurtlePathLengthArea=TurtlePathLengthArea;window.stringifyFormatted=stringifyFormatted;})(window);</script>
<script> "use strict";const deg=Math.PI/180;const rad2deg=1/deg;</script>
<script> function formatFloat(num,decimalPlaces){return num.toFixed(decimalPlaces);}function deepCopyArray(arr){return arr.map(item=>Array.isArray(item)?deepCopyArray(item):item);}</script>
<script id="main" type="text/javascript"> "use strict";let cookieCutterArea=2000;let outlines={"Duck":{"turtlePath":[[0.4,-10.0],[13.297,25.0],[3,-80.0],[4,160.0],[22.913,90.0],[15,90.0],[5,-90.0],[5,20.0],[3,170.0],[2,-20.0],[3,-90.0],[15,220.0],[5,-125.0]]}};let brickworks={"centered":[[[-0.45,0.9],[-1.35,0.9],[0.45,0.9],[1.35,0.9]],[[-0.8,0.8],[-1.6,0.8],[0.8,0.8],[1.6,0.8],[0.0,0.8]],[[-1.1,0.733],[-1.833,0.733],[1.1,0.733],[1.833,0.733],[-0.367,0.733],[0.367,0.733]],[[-0.92,0.92],[-1.84,0.92],[0.92,0.92],[1.84,0.92],[0.0,0.92]],[[0.0,1.0],[-1.9,1.0],[1.9,1.0]],[[0.0,0.8],[-2.0,1.0],[2.0,1.0]],[[0.0,0.6],[-2.05,0.9],[2.05,0.9]],[[0.0,0.5],[-2.05,0.9],[2.05,0.9]],[[0.0,0.5],[-2.05,0.9],[2.05,0.9]],[[0.0,0.5],[-1.95,0.9],[1.95,0.9]],[[0.0,0.5],[-1.85,0.9],[1.85,0.9]],[[0.0,0.5],[-1.7,1.0],[1.7,1.0]],[[0.0,0.5],[-1.5,1.0],[1.5,1.0]],[[0.0,0.5],[-1.3,1.0],[1.3,1.0]],[[0.0,0.5],[-1.1,1.0],[1.1,1.0]],[[0.0,0.5],[-0.9,1.0],[0.9,1.0]],[[0.0,0.6],[-0.75,0.9],[0.75,0.9]],[[-0.5,1.0],[0.5,1.0]],[[-0.533,0.533],[-0.0,0.533],[0.533,0.533]],[[-0.3,0.6],[0.3,0.6]]]};function updateOutlineSelector(){while(outlineSelector.options.length)outlineSelector.options.remove(0);Object.entries(outlines).forEach(([k2,v2])=>{v2["turtlePath"].forEach((x)=>{x[1]*=deg;});var el=document.createElement("option");el.textContent=k2;el.value=k2;outlineSelector.appendChild(el);});const event=new Event('change',{bubbles:true});outlineSelector.dispatchEvent(event);};function readSingleFile(e){var file=e.target.files[0];if(!file){return;}var reader=new FileReader();reader.onload=function(e){var contents=e.target.result;let decodedContents=JSON.parse(contents);outlines=decodedContents["outlines"];updateOutlineSelector();brickworks=decodedContents["brickworks"];document.getElementById('downloadBtn').disabled=false;};reader.readAsText(file);}function displayContents(contents){var element=document.getElementById('file-content');element.textContent=contents;}function drawSelectedOutline(e){const canvas=document.getElementById('arcCanvas');const ctx=canvas.getContext('2d');ctx.reset();ctx.clearRect(0,0,canvas.width,canvas.height);ctx.translate(canvas.width/2,canvas.height/2);ctx.scale(1,1);let key;try{key=e.target.value;}catch(e){}if(key===undefined)key="Duck";let[l,a,,,centroid]=TurtlePathLengthArea(outlines[key]["turtlePath"]);let scale=Math.sqrt(cookieCutterArea/a);debugLog("key= "+key+", l= "+l+", a= "+a+", scale= "+scale);let a0=[1,0];let p0=[-centroid[0]*scale*5,-centroid[1]*scale*5];plot_segments(ctx,{segs:outlines[key]["turtlePath"],p0:p0,a0:a0,scale:scale*5});plot_segments(ctx,{segs:outlines[key]["turtlePath"],p0:p0,a0:a0,offs:3,scale:scale*5});}document.getElementById('file-input').addEventListener('change',readSingleFile,false);var outlineSelector;function initDocument(){outlineSelector=document.getElementById('outline-selector');outlineSelector.addEventListener('change',drawSelectedOutline,false);updateOutlineSelector();drawSelectedOutline();}document.getElementById('downloadBtn').addEventListener('click',function(){if(outlines&&brickworks){const outlinesCopy={};for(let key in outlines){let outline={};outlinesCopy[key]=outline;let valueArrayCopy=[... outlines[key]["turtlePath"]];outlinesCopy[key]["turtlePath"]=valueArrayCopy;valueArrayCopy.forEach(([l,angRad],i,arr)=>{arr[i]=[l,Math.round(angRad*rad2deg*1000)/1000];});};const content='{\n"outlines":'+stringifyFormatted(outlinesCopy,2,3)+', \n"brickworks":'+stringifyFormatted(brickworks,2,2)+"\n}";const blob=new Blob([content],{type:'text/json'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download='cookie-cutters_downloaded.json';link.click();URL.revokeObjectURL(link.href);}});document.getElementById('downloadAppBtn').addEventListener('click',function(){const link=document.createElement('a');link.href="/Turtle/output.html";link.download="Turtle.html";link.click();});document.addEventListener("DOMContentLoaded",initDocument);</script>
<br/>
<a download="Turtle.html" href="/Turtle/output.html">Download Turtle.html</a>
</body>
</html>